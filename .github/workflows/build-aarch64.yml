name: build-aarch64-3.17.5
on: workflow_dispatch
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - run: git fetch --tags && git checkout 3.17.5
      - run: sudo apt-get update && sudo apt-get install -y \
          build-essential pkg-config git wget curl \
          zlib1g-dev libpng-dev libsdl2-dev \
          libgles2-mesa-dev libgl1-mesa-dev \
          qtbase5-dev qttools5-dev qtbase5-dev-tools \
          qtmultimedia5-dev libqt5svg5-dev \
          libcurl4-openssl-dev libssl-dev p7zip-full
      - run: (qmake6 || QT_SELECT=5 qmake)
      - run: make -j$(nproc)
      - run: mkdir -p out && cp Skyscraper out/Skyscraper.aarch64
      - run: ldd Skyscraper | awk '/=>/ {print $3}' | xargs -I{} cp {} out/ || true
      - uses: actions/upload-artifact@v4
        with: { name: skyscraper-3.17.5-aarch64, path: out }
